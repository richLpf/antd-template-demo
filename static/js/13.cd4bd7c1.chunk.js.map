{"version":3,"sources":["utils/download.js","utils/localStorage.js","components/UTable/index.js","api/request.js","api/index.js","pages/table/base.js","pages/table/group.js","pages/table/index.js"],"names":["a","fields","dataSource","filename","download","csv","blob","Blob","type","url","window","URL","createObjectURL","document","createElement","href","click","revokeObjectURL","err","console","error","Parser","withBOM","parse","exportCSV","getLocalStorage","key","value","localStorage","getItem","JSON","e","CheckboxGroup","Group","UTable","forwardRef","props","ref","columns","storeKey","rowKey","query","leftAction","filterParams","size","useBackendPagination","useBackendSearch","useReloadButton","useSearchInput","limit","exportData","exportQuery","useState","Data","setData","total","setTotal","loading","setLoading","exportLoading","setExportLoading","tableColumns","setTableColumns","undefined","FuzzySearch","setFuzzySearch","Page","PageSize","pagination","setPagination","useEffect","fetchData","toQueryParams","useCallback","data","log","then","res","Total","catch","defaultColumns","storeColumns","filter","item","includes","useImperativeHandle","sortField","sorter","field","sortOrder","order","filters","throttleRef","current","handleDownload","exportPromise","message","String","Array","isArray","length","onChange","useRef","throttle","fetchCondition","onSearch","tableProps","Object","keys","some","k","pageSize","scroll","x","ColumnsSettingContent","style","width","options","map","label","title","values","selectedColumns","setItem","stringify","setLocalStorage","column","CardExtra","suffix","SearchOutlined","onClick","target","placeholder","onPressEnter","icon","DownloadOutlined","ReloadOutlined","placement","content","trigger","SettingOutlined","extra","bordered","defaultProps","usePagination","displayName","config","baseURL","process","REACT_APP_API","userInfo","request","params","Promise","resolve","reject","instance","axios","create","assign","withCredentials","timeout","interceptors","use","headers","token","remote_user","response","RetCode","Message","location","replace","GetList","method","TableBase","tableRef","getList","id","dataIndex","render","val","Api","result","row","age","TableGroup","Column","ColumnGroup","firstName","lastName","address","tags","tag","color","text","record","TabPane","TableDemo","tab"],"mappings":"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","file":"static/js/13.cd4bd7c1.chunk.js","sourcesContent":["/**\n * @function exportCSV\n * @description 下载csv文件\n * @param {Array} fields 表头字段\n * @param {Array} dataSource 文件数据\n * @param {String} filename 文件名\n */\n\nasync function exportCSV({\n  fields = [],\n  dataSource = [],\n  filename = \"download\",\n}) {\n  const download = (csv) => {\n    try {\n      const blob = new Blob([csv, { type: \"text/csv\" }]);\n      const url = window.URL.createObjectURL(blob);\n      const a = document.createElement(\"a\");\n      a.href = url;\n      a.download = filename;\n      a.click();\n      window.URL.revokeObjectURL(url);\n    } catch (err) {\n      console.error(err);\n    }\n  };\n  try {\n    const { Parser } = await import(\"json2csv\");\n    const csv = new Parser({ fields, withBOM: true }).parse(dataSource);\n    download(csv);\n  } catch (err) {\n    console.error(err);\n  }\n}\n\nexport default exportCSV;\n","export function setLocalStorage(key, value) {\n  try {\n    window.localStorage.setItem(key, JSON.stringify(value));\n  } catch (e) {\n    console.log(e.message);\n  }\n}\n\nexport function getLocalStorage(key) {\n  const value = window.localStorage.getItem(key);\n  try {\n    return JSON.parse(value);\n  } catch (e) {\n    return value;\n  }\n}\n\n// 获取某个系统缓存数据，包括用户信息\nexport function getOneSystemStore(key) {\n  return getLocalStorage(key);\n}\n\n// 获取系统缓存数据，包括用户信息\nexport function getSystemStore(keys) {\n  const systemStore = {};\n  Object.keys(keys).forEach((item) => {\n    systemStore[item] = getLocalStorage(keys[item]);\n  });\n\n  return systemStore;\n}\n","import React, {\n  useState,\n  useEffect,\n  useImperativeHandle,\n  forwardRef,\n  useCallback,\n  useRef,\n} from \"react\";\nimport {\n  ReloadOutlined,\n  DownloadOutlined,\n  SearchOutlined,\n  SettingOutlined,\n} from \"@ant-design/icons\";\nimport {\n  Card,\n  Table,\n  Button,\n  Space,\n  Input,\n  message,\n  Checkbox,\n  Tooltip,\n  Popover,\n} from \"antd\";\nimport PropTypes from \"prop-types\";\n\nimport exportCSV from \"../../utils/download\";\nimport { throttle } from \"../../utils/common\";\nimport { getLocalStorage, setLocalStorage } from \"src/utils/localStorage\";\n\nconst CheckboxGroup = Checkbox.Group;\n\nconst DefaultPageSize = 9999999;\n\nconst UTable = forwardRef((props, ref) => {\n  const {\n    columns,\n    storeKey,\n    dataSource,\n    rowKey,\n    query,\n    leftAction,\n    download,\n    filterParams,\n    size,\n    useBackendPagination,\n    useBackendSearch,\n    useReloadButton,\n    useSearchInput,\n  } = props;\n\n  const { limit, exportData, exportQuery } = download || {};\n\n  const [Data, setData] = useState(dataSource || []);\n  const [total, setTotal] = useState(0);\n  const [loading, setLoading] = useState(false);\n  const [exportLoading, setExportLoading] = useState(false);\n  const [tableColumns, setTableColumns] = useState([]);\n  const [FuzzySearch, setFuzzySearch] = useState(undefined);\n  const [pagination, setPagination] = useState({\n    Page: 1,\n    PageSize: 10,\n  });\n\n  useEffect(() => {\n    fetchData({ ...toQueryParams() });\n  }, []);\n\n  const fetchData = useCallback(\n    async (data) => {\n      console.log(\"fetchData\", data);\n\n      setLoading(true);\n      return (\n        query &&\n        query(data)\n          .then((res) => {\n            const { Data, Total } = res || {};\n            setData(Data || []);\n            setTotal(Total || 0);\n            setLoading(false);\n            return Data;\n          })\n          .catch((err) => {\n            setLoading(false);\n            return err;\n          })\n      );\n    },\n    [query]\n  );\n\n  useEffect(() => {\n    const defaultColumns = columns;\n    const storeColumns = getLocalStorage(storeKey);\n\n    if (storeColumns) {\n      setTableColumns(\n        columns.filter((item) => (storeColumns || []).includes(item.key))\n      );\n      return;\n    }\n\n    setTableColumns(defaultColumns);\n    // eslint-disable-next-line\n  }, [columns]);\n\n  // 暴露接口调用和表格数据给父组件\n  useImperativeHandle(\n    ref,\n    () => ({\n      fetchData: () => fetchData({ ...toQueryParams() }),\n      data: Data,\n    }),\n    [Data, fetchData]\n  );\n\n  const toQueryParams = useCallback(\n    (data) => {\n      const { Page, PageSize, FuzzySearch } = pagination;\n      return {\n        ...(useBackendPagination\n          ? {\n              Page: data?.Page || Page,\n              PageSize: data?.PageSize || PageSize,\n              FuzzySearch: data?.FuzzySearch || FuzzySearch,\n              sortField: data?.sorter?.field,\n              sortOrder: data?.sorter?.order,\n              ...(data?.filters ? data.filters : {}),\n              ...filterParams,\n            }\n          : {\n              Page: 1,\n              PageSize: DefaultPageSize,\n              ...filterParams,\n            }),\n      };\n    },\n    [filterParams, pagination, useBackendPagination]\n  );\n\n  useEffect(() => {\n    // 外部搜索\n    console.log(throttleRef.current);\n    throttleRef.current(\n      pagination.Page,\n      pagination.PageSize || 10,\n      useBackendPagination\n    );\n  }, [filterParams]);\n\n  const handleDownload = async () => {\n    let dataSource = Data;\n    if (useBackendPagination) {\n      setExportLoading(true);\n      const exportPromise = exportQuery\n        ? exportQuery({\n            ...toQueryParams(),\n          })\n        : query({\n            ...toQueryParams(),\n            Page: 1,\n            ...(limit ? { PageSize: limit } : {}),\n          });\n      dataSource = await exportPromise\n        .then((res) => res.Data)\n        .catch((err) => {\n          setExportLoading(false);\n          message.error(String(err));\n          return null;\n        });\n      setExportLoading(false);\n    }\n    if (Array.isArray(dataSource) && dataSource.length) {\n      const { data, fields } = exportData(dataSource);\n      exportCSV({ fields, dataSource: data, filename: \"list.csv\" });\n    }\n  };\n\n  // 分页切换\n  const onChange = useCallback((Page, PageSize, pagination) => {\n    setPagination({ ...pagination, Page, PageSize });\n    if (useBackendPagination) {\n      fetchData({ FuzzySearch, Page, PageSize });\n    }\n  }, []);\n\n  const getList = (Page, PageSize, fetchCondition) => {\n    setPagination({ Page, PageSize });\n    if (fetchCondition) {\n      fetchData({ FuzzySearch, Page, PageSize });\n    }\n  };\n\n  const throttleRef = useRef(throttle(getList, 1000));\n\n  // 自带搜索\n  const onSearch = () => {\n    if (!useBackendSearch) {\n      return;\n    }\n    // 后端分页查询\n    const page = 1;\n    throttleRef.current(page, pagination.PageSize || 10, useBackendPagination);\n  };\n\n  const handleTableChange = (pagination, filters, sorter) => {\n    console.log(sorter);\n    fetchData({ ...toQueryParams({ pagination, filters, sorter }) });\n  };\n\n  const tableProps = useCallback(() => {\n    return {\n      dataSource:\n        useBackendPagination && useBackendSearch\n          ? Data\n          : Data?.filter(\n              (item) =>\n                !FuzzySearch ||\n                Object.keys(item).some((k) => {\n                  return (\n                    typeof item[k] !== Object &&\n                    String(item[k]).includes(FuzzySearch)\n                  );\n                })\n            ),\n      ...(useBackendPagination\n        ? {\n            pagination: {\n              current: pagination.Page,\n              pageSize: pagination.PageSize,\n              total: total,\n              onChange: (Page, PageSize) =>\n                onChange(Page, PageSize, pagination),\n            },\n          }\n        : {}),\n      scroll: { x: true },\n    };\n  }, [\n    Data,\n    FuzzySearch,\n    total,\n    useBackendPagination,\n    useBackendSearch,\n    pagination,\n    onChange,\n  ]);\n\n  const ColumnsSettingContent = (\n    <CheckboxGroup\n      style={{ width: 150 }}\n      options={columns.map((item) => ({ label: item.title, value: item.key }))}\n      value={tableColumns.map((item) => item.key)}\n      onChange={(values) => {\n        const selectedColumns = columns.filter((item) =>\n          values.includes(item.key)\n        );\n        setTableColumns(selectedColumns);\n        if (storeKey) {\n          setLocalStorage(\n            storeKey,\n            selectedColumns.map((column) => column.key)\n          );\n        }\n      }}\n    />\n  );\n\n  const CardExtra = (\n    <Space>\n      {useSearchInput ? (\n        <Input\n          size={size}\n          suffix={<SearchOutlined onClick={onSearch} />}\n          value={FuzzySearch}\n          onChange={(e) => setFuzzySearch(e.target.value)}\n          placeholder=\"search...\"\n          onPressEnter={onSearch}\n        />\n      ) : null}\n\n      {download && (\n        <Button\n          size={size}\n          loading={exportLoading}\n          onClick={handleDownload}\n          icon={<DownloadOutlined />}\n        ></Button>\n      )}\n\n      {useReloadButton ? (\n        <Button\n          size={size}\n          onClick={() => fetchData({ ...toQueryParams() })}\n          icon={<ReloadOutlined />}\n        ></Button>\n      ) : null}\n\n      {storeKey && (\n        <Tooltip key={\"ColumnsSetting\"} placement=\"top\" title=\"自定义列表\">\n          <Popover\n            placement=\"left\"\n            title=\"自定义列表\"\n            content={ColumnsSettingContent}\n            trigger=\"click\"\n          >\n            <Button size={size} icon={<SettingOutlined />} />\n          </Popover>\n        </Tooltip>\n      )}\n    </Space>\n  );\n\n  return (\n    <Card size={size} title={leftAction} extra={CardExtra}>\n      <Table\n        size={size}\n        columns={tableColumns}\n        rowKey={rowKey}\n        loading={loading}\n        bordered\n        onChange={handleTableChange}\n        {...tableProps()}\n      />\n    </Card>\n  );\n});\n\nUTable.defaultProps = {\n  usePagination: false,\n  size: \"middle\",\n  useBackendSearch: false,\n};\n\nUTable.propTypes = {\n  download: PropTypes.shape({\n    limit: PropTypes.number,\n    exportData: PropTypes.func,\n    exportQuery: PropTypes.func, // 下载是否为单独的接口\n    ResponseDataKey: PropTypes.string, // 接口返回数据的key\n    ResponseTotalKey: PropTypes.string, // 接口返回Total参数名\n  }),\n  pagination: PropTypes.object,\n  useBackendPagination: PropTypes.bool, // 是否使用后端分页\n  //   filter: PropTypes.object, // 过滤参数\n  query: PropTypes.func, // 请求API\n  columns: PropTypes.array.isRequired, // 标题数据\n  storeKey: PropTypes.string, // 储存动态展示列的localStorage的key\n  useReloadButton: PropTypes.bool, // 刷新表格按钮\n  leftAction: PropTypes.any, // 表格头部左侧按钮操作\n  filterParams: PropTypes.object,\n  size: PropTypes.oneOf([\"small\", \"large\", \"middle\"]),\n  useBackendSearch: PropTypes.bool, // 是否使用后端搜索\n  useSearchInput: PropTypes.bool,\n  dataSource: PropTypes.array,\n  rowKey: PropTypes.string,\n  onChange: PropTypes.func, // Table原生的change\n};\n\nUTable.displayName = \"UTable\";\n\nexport default UTable;\n","import { message } from \"antd\";\nimport axios from \"axios\";\n\nconst config = {};\nif (process.env.REACT_APP_ENV !== \"development\") {\n  config.baseURL = process.env.REACT_APP_API;\n}\n\nconst userInfo = {\n  username: \"user\",\n  token: \"123456\",\n};\n\nfunction request(params) {\n  return new Promise((resolve, reject) => {\n    const instance = axios.create(\n      Object.assign(\n        {\n          withCredentials: false,\n          \"content-type\": \"application/json\",\n          timeout: 30000,\n        },\n        config\n      )\n    );\n\n    instance.interceptors.request.use(\n      (config) => {\n        if (userInfo.token) {\n          config.headers.token = userInfo.token;\n        }\n        if (userInfo.username) {\n          config.headers.remote_user = userInfo.username;\n        }\n        return config;\n      },\n      (err) => {\n        return reject(err);\n      }\n    );\n\n    instance.interceptors.response.use(\n      (res) => {\n        return res;\n      },\n      (err) => {\n        return reject(err.message);\n      }\n    );\n\n    instance(params)\n      .then((res) => {\n        const {\n          data: { RetCode, Message },\n          data,\n        } = res;\n        if (RetCode === 10000) {\n          message.error(\"请登陆\");\n          window.location.replace(\"/login\");\n          return;\n        } else if (RetCode !== 0) {\n          message.error(Message);\n          resolve(data);\n        } else {\n          resolve(data);\n        }\n      })\n      .catch((err) => {\n        reject(err);\n      });\n  });\n}\n\nexport default request;\n","import request from \"./request\";\n// login\nexport const Login = (data) => {\n  return request({\n    url: \"/v1/signIn\",\n    method: \"post\",\n    data,\n  });\n};\n\n// mock table api\nexport const GetList = (query) => {\n  return request({\n    url: \"/v1/list\",\n    method: \"get\",\n    query,\n  });\n};\n","import React, { Fragment, useEffect, useState, useRef } from \"react\";\nimport { Button, Space } from \"antd\";\nimport UTable from \"src/components/UTable\";\nimport * as Api from \"../../api\";\n\nfunction TableBase() {\n  const [Data, setData] = useState([]);\n  const tableRef = useRef();\n\n  useEffect(() => {\n    getList({ id: 1 });\n  }, []);\n\n  document.title = \"test\";\n\n  const columns = [\n    {\n      title: \"姓名名字名字名\",\n      dataIndex: \"name\",\n      key: \"name\",\n    },\n    {\n      title: \"年龄\",\n      dataIndex: \"age\",\n      key: \"age\",\n      sorter: true,\n      render: (val) => `${val}岁`,\n    },\n    {\n      title: \"住址\",\n      dataIndex: \"address\",\n      key: \"address\",\n    },\n  ];\n\n  const getList = (data) => {\n    Api.GetList(data).then((res) => {\n      const { Data } = JSON.parse(JSON.stringify(res));\n      setData(Data);\n    });\n  };\n\n  const handleAdd = () => {\n    tableRef.current.fetchData();\n    const result = tableRef.current.data;\n    console.log(\"result\", result);\n  };\n\n  const leftAction = (\n    <Space>\n      <Button type=\"primary\" onClick={handleAdd}>\n        添加\n      </Button>\n    </Space>\n  );\n\n  return (\n    <Fragment>\n      <UTable\n        ref={tableRef}\n        rowKey=\"key\"\n        storeKey=\"base-table\"\n        download={{\n          limit: 10000,\n          exportData: (row) => {\n            return {\n              fields: columns\n                .filter((item) => item.key !== \"actions\")\n                .map(({ title, key }) => ({\n                  label: title,\n                  value: key,\n                })),\n              data: row.map((item) => ({\n                ...item,\n                age: `${item.age}岁`,\n              })),\n            };\n          },\n        }}\n        leftAction={leftAction}\n        query={Api.GetList}\n        dataSource={Data}\n        columns={columns}\n      />\n    </Fragment>\n  );\n}\n\nexport default TableBase;\n","import React from \"react\";\nimport { Table, Tag, Space, Button } from \"antd\";\n\nfunction TableGroup() {\n  const { Column, ColumnGroup } = Table;\n\n  const data = [\n    {\n      key: \"1\",\n      firstName: \"John\",\n      lastName: \"Brown\",\n      age: 32,\n      address: \"New York No. 1 Lake Park\",\n      tags: [\"nice\", \"developer\"],\n    },\n    {\n      key: \"2\",\n      firstName: \"Jim\",\n      lastName: \"Green\",\n      age: 42,\n      address: \"London No. 1 Lake Park\",\n      tags: [\"loser\"],\n    },\n    {\n      key: \"3\",\n      firstName: \"Joe\",\n      lastName: \"Black\",\n      age: 32,\n      address: \"Sidney No. 1 Lake Park\",\n      tags: [\"cool\", \"teacher\"],\n    },\n  ];\n\n  return (\n    <Table dataSource={data}>\n      <ColumnGroup title=\"Name\">\n        <Column title=\"First Name\" dataIndex=\"firstName\" key=\"firstName\" />\n        <Column title=\"Last Name\" dataIndex=\"lastName\" key=\"lastName\" />\n      </ColumnGroup>\n      <Column title=\"Age\" dataIndex=\"age\" key=\"age\" />\n      <Column title=\"Address\" dataIndex=\"address\" key=\"address\" />\n      <Column\n        title=\"Tags\"\n        dataIndex=\"tags\"\n        key=\"tags\"\n        render={(tags) => (\n          <>\n            {tags.map((tag) => (\n              <Tag color=\"blue\" key={tag}>\n                {tag}\n              </Tag>\n            ))}\n          </>\n        )}\n      />\n      <Column\n        title=\"Action\"\n        key=\"action\"\n        render={(text, record) => (\n          <Space size=\"middle\">\n            <Button type=\"link\">Invite {record.lastName}</Button>\n            <Button type=\"link\">Delete</Button>\n          </Space>\n        )}\n      />\n    </Table>\n  );\n}\n\nexport default TableGroup;\n","import React, { Fragment } from \"react\";\nimport { Tabs } from \"antd\";\nimport TableBase from \"./base\";\nimport TableGroup from \"./group\";\n\nconst { TabPane } = Tabs;\n\nfunction TableDemo() {\n  return (\n    <Fragment>\n      <Tabs>\n        <TabPane key={1} tab=\"封装表格\">\n          <TableBase />\n        </TabPane>\n        <TabPane key={2} tab=\"基础表格\">\n          <TableBase />\n        </TabPane>\n        <TabPane key={3} tab=\"滚动表格\">\n          <TableGroup />\n        </TabPane>\n      </Tabs>\n    </Fragment>\n  );\n}\n\nexport default TableDemo;\n"],"sourceRoot":""}