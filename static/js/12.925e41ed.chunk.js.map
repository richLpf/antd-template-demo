{"version":3,"sources":["components/TagsMore/index.js","pages/system/User/Columns.js","pages/system/User/Filter.js","pages/system/User/index.js","pages/system/User/FormItem.js"],"names":["TagsMore","props","list","map","item","defaultProps","Columns","handleEdit","handleDelete","title","dataIndex","key","render","val","length","RoleName","sorter","formatTime","_","record","type","size","onClick","onConfirm","okText","cancelText","danger","Filter","label","span","options","roleList","Name","value","ID","User","useState","visible","setVisible","confirmLoading","setConfirmLoading","setRoleList","editInfo","setEditInfo","FilterParams","setFilterParams","tableRef","useRef","useEffect","getRole","GetRoleList","then","res","Data","catch","err","console","log","className","TableFilter","onSearch","fields","rowCount","defaultValue","UTable","rowKey","ref","columns","DeleteUser","UserID","current","fetchData","useReloadButton","useBackendPagination","query","GetUserList","filterParams","leftAction","FormModal","initialValues","data","Object","keys","RoleID","RoleInfo","itemOption","name","content","rules","required","placeholder","option","allowClear","mode","cancel","handleOk","params","UpdateUser","CreateUser","message","success","HandleCreateUser"],"mappings":"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","file":"static/js/12.925e41ed.chunk.js","sourcesContent":["import React, { Fragment } from \"react\";\nimport { Space, Tag } from \"antd\";\nimport PropTypes from \"prop-types\";\n\nfunction TagsMore(props) {\n  const { list = [] } = props;\n\n  return (\n    <Fragment>\n      <Space>\n        {list?.map((item) => (\n          <Tag key={item}>{item}</Tag>\n        ))}\n      </Space>\n    </Fragment>\n  );\n}\n\nTagsMore.defaultProps = {\n  list: [\"name\"],\n};\n\nTagsMore.propTypes = {\n  list: PropTypes.array,\n};\n\nexport default TagsMore;\n","import React from \"react\";\nimport { Space, Button, Popconfirm } from \"antd\";\nimport { formatTime } from \"src/utils/common\";\nimport TagsMore from \"src/components/TagsMore\";\n\nconst Columns = ({ handleEdit, handleDelete }) => [\n  {\n    title: \"ID\",\n    dataIndex: \"ID\",\n    key: \"ID\",\n  },\n  {\n    title: \"中文名\",\n    dataIndex: \"ChName\",\n    key: \"ChName\",\n  },\n  {\n    title: \"用户名\",\n    dataIndex: \"Name\",\n    key: \"Name\",\n  },\n  {\n    title: \"角色名称\",\n    dataIndex: \"RoleInfo\",\n    key: \"RoleInfo\",\n    render: (val) =>\n      val && val.length ? (\n        <TagsMore list={val.map((item) => item.RoleName)} />\n      ) : (\n        \"\"\n      ),\n  },\n  {\n    title: \"邮箱\",\n    dataIndex: \"Email\",\n    key: \"Email\",\n  },\n  {\n    title: \"创建时间\",\n    dataIndex: \"CreateTime\",\n    key: \"CreateTime\",\n    sorter: true,\n    render: (val) => formatTime(val),\n  },\n  {\n    title: \"操作\",\n    dataIndex: \"actions\",\n    key: \"actions\",\n    render: (_, record) => {\n      return (\n        <Space>\n          <Button type=\"link\" size=\"small\" onClick={() => handleEdit(record)}>\n            编辑\n          </Button>\n          <Popconfirm\n            title=\"删除后，将无法恢复，确定删除吗？\"\n            onConfirm={() => handleDelete(record)}\n            okText=\"确定\"\n            cancelText=\"取消\"\n          >\n            <Button type=\"link\" danger size=\"small\">\n              删除\n            </Button>\n          </Popconfirm>\n        </Space>\n      );\n    },\n  },\n];\n\nexport default Columns;\n","function Filter({ roleList }) {\n  const filters = [\n    {\n      label: \"英文名\",\n      key: \"Name\",\n      type: \"Input\",\n      span: 8,\n    },\n    {\n      label: \"角色\",\n      key: \"RoleID\",\n      type: \"Select\",\n      // type: \"SelectMultiple\",\n      options: roleList.map((item) => ({\n        label: item.Name,\n        value: item.ID,\n      })),\n      span: 8,\n    },\n    {\n      label: \"用户ID\",\n      key: \"UserID\",\n      type: \"Input\",\n      span: 8,\n    },\n  ];\n\n  return filters;\n}\n\nexport default Filter;\n","import React, { Fragment, useState, useEffect, useRef } from \"react\";\nimport { Button, message, Space, Card } from \"antd\";\nimport Columns from \"./Columns\";\nimport UTable from \"src/components/UTable\";\nimport FormModal from \"src/components/UForm/FormModal\";\nimport {\n  GetUserList,\n  GetRoleList,\n  CreateUser,\n  DeleteUser,\n  UpdateUser,\n} from \"src/api/acl\";\nimport TableFilter from \"src/components/TableFilter\";\nimport Filter from \"./Filter\";\nimport { itemOption } from \"./FormItem\";\n\nfunction User() {\n  const [visible, setVisible] = useState(false);\n  const [confirmLoading, setConfirmLoading] = useState(false);\n  const [roleList, setRoleList] = useState([]);\n  const [editInfo, setEditInfo] = useState({});\n  const [FilterParams, setFilterParams] = useState({});\n  const tableRef = useRef();\n\n  useEffect(() => {\n    getRole();\n  }, []);\n\n  const handleEdit = (record) => {\n    setEditInfo(record);\n    setVisible(true);\n  };\n\n  const getRole = () => {\n    GetRoleList()\n      .then((res) => {\n        const { Data } = res;\n        setRoleList(Data || []);\n      })\n      .catch((err) => {\n        console.log(\"err\", err);\n      });\n  };\n\n  const HandleCreateUser = (params) => {\n    CreateUser(params)\n      .then((res) => {\n        console.log(\"res\", res);\n        setConfirmLoading(false);\n        message.success(\"新增成功\");\n        setVisible(false);\n        setEditInfo({});\n        tableRef.current && tableRef.current.fetchData();\n      })\n      .catch(() => {\n        setConfirmLoading(false);\n      });\n  };\n\n  const HandleUpdateUser = (params) => {\n    UpdateUser(params)\n      .then((res) => {\n        console.log(\"res\", res);\n        setConfirmLoading(false);\n        setVisible(false);\n        setEditInfo({});\n        tableRef.current && tableRef.current.fetchData();\n      })\n      .catch(() => {\n        setConfirmLoading(false);\n      });\n  };\n\n  const handleOk = (val) => {\n    console.log(\"val\", val);\n    setConfirmLoading(true);\n    if (editInfo && Object.keys(editInfo).length) {\n      HandleUpdateUser({ ...val, UserID: editInfo.ID });\n    } else {\n      HandleCreateUser(val);\n    }\n  };\n\n  const createUser = () => {\n    setVisible(true);\n  };\n\n  const initialValues = (data) => {\n    if (data && Object.keys(data).length) {\n      return {\n        ...data,\n        RoleID: data?.RoleInfo?.map((item) => item.RoleID),\n      };\n    }\n  };\n\n  const handleDelete = (record) => {\n    DeleteUser({ UserID: record.ID }).then(() => {\n      tableRef.current && tableRef.current.fetchData();\n    });\n  };\n\n  const onSearch = (value) => {\n    console.log(\"value\", value);\n    setFilterParams(value);\n  };\n\n  const filterInitialValues = {};\n\n  return (\n    <Fragment>\n      <Card className=\"m-b-10\">\n        <TableFilter\n          onSearch={onSearch}\n          fields={Filter({ roleList })}\n          rowCount={3}\n          defaultValue={filterInitialValues}\n        />\n      </Card>\n      <UTable\n        rowKey=\"ID\"\n        ref={tableRef}\n        columns={Columns({ handleEdit, handleDelete })}\n        useReloadButton\n        useBackendPagination\n        query={GetUserList}\n        filterParams={FilterParams}\n        leftAction={\n          <Space>\n            <Button type=\"primary\" onClick={createUser}>\n              创建用户\n            </Button>\n            <Button>批量上传</Button>\n          </Space>\n        }\n      />\n      {visible ? (\n        <FormModal\n          initialValues={initialValues(editInfo)}\n          itemOption={itemOption({ roleList })}\n          visible={visible}\n          cancel={() => setVisible(false)}\n          handleOk={handleOk}\n          editInfo={editInfo}\n          confirmLoading={confirmLoading}\n        />\n      ) : null}\n    </Fragment>\n  );\n}\n\nexport default User;\n","export const itemOption = ({ roleList }) => [\n  {\n    name: \"Name\",\n    label: \"英文名\",\n    content: \"Input\",\n    rules: {\n      required: true,\n    },\n  },\n  {\n    name: \"ChName\",\n    label: \"中文名\",\n    content: \"Input\",\n    rules: {\n      required: true,\n    },\n  },\n  {\n    name: \"Phone\",\n    label: \"电话号码\",\n    content: \"Input\",\n    rules: {\n      required: true,\n    },\n  },\n  {\n    name: \"RoleID\",\n    label: \"角色\",\n    rules: {\n      required: true,\n    },\n    content: \"Select\",\n    placeholder: \"请选择\",\n    option: {\n      required: true,\n      list: roleList,\n      label: \"Name\",\n      value: \"ID\",\n    },\n    allowClear: true,\n    mode: \"multiple\",\n  },\n];\n"],"sourceRoot":""}